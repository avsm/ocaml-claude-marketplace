---
description: Initialize a new OCaml project with dune, opam, CI, and standard files
argument-hint: [project-name]
allowed-tools: [Read, Write, Edit, Bash, Glob, Grep]
---

# Initialize OCaml Project

This command creates a new OCaml project with all standard files and configuration.

## Arguments

Project name: $ARGUMENTS (defaults to current directory name if not provided)

## Configuration

Read user configuration from `~/.claude/ocaml-config.json`. If it doesn't exist, prompt the user for:
- Author name
- Author email
- Preferred license (ISC, MIT, Apache-2.0)
- CI platform (github, tangled, gitlab)
- Git hosting (github.com/user, tangled.org/@user, gitlab.com/user)
- OCaml version minimum (default: 5.2.0)

Offer to save configuration to `~/.claude/ocaml-config.json` for future use.

## Files to Create

### Essential Files

1. **dune-project** - Build configuration with opam generation
2. **dune** (root) - With `(data_only_dirs third_party)`
3. **<project>.opam** - Generated by dune (do not create manually)
4. **.ocamlformat** - Code formatting (version 0.28.1)
5. **.gitignore** - Standard OCaml ignores + third_party/
6. **LICENSE.md** - Based on configured license
7. **README.md** - Project documentation template

### CI Configuration (based on ci_platform setting)

- **github**: `.github/workflows/build.yml`
- **tangled**: `.tangled/workflows/build.yml`
- **gitlab**: `.gitlab-ci.yml`

### Source Files

1. **lib/dune** - Library stanza
2. **lib/<project>.ml** - Main module with license header
3. **lib/<project>.mli** - Interface with documentation

### Test Files

1. **test/dune** - Test configuration
2. **test/test_<project>.ml** - Basic test skeleton with Alcotest

## Workflow

1. Check if directory is empty or confirm overwrite
2. Read or prompt for configuration
3. Determine project name from argument or directory
4. Create all files using templates from the ocaml-project-setup skill
5. Run `dune build @check` to verify setup
6. Report success and suggest next steps

## Template Variables

Replace these in templates:
- `{{PROJECT_NAME}}` - Project name (snake_case)
- `{{PROJECT_NAME_KEBAB}}` - Project name (kebab-case)
- `{{AUTHOR_NAME}}` - From config
- `{{AUTHOR_EMAIL}}` - From config
- `{{YEAR}}` - Current year
- `{{LICENSE}}` - License identifier
- `{{OCAML_VERSION}}` - Minimum OCaml version
- `{{GIT_URL}}` - Full git URL based on hosting config

## Example Usage

```
/init-ocaml my-library
/init-ocaml
```

## Success Output

```
Created OCaml project: my-library

Files created:
  - dune-project
  - dune
  - .ocamlformat
  - .gitignore
  - LICENSE.md
  - README.md
  - .github/workflows/build.yml
  - lib/dune
  - lib/my_library.ml
  - lib/my_library.mli
  - test/dune
  - test/test_my_library.ml

Next steps:
  1. Run `opam install . --deps-only` to install dependencies
  2. Run `dune build` to build the project
  3. Run `dune runtest` to run tests
```
